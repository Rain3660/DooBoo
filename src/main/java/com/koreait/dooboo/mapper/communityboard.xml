<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.koreait.dooboo.communityboard.dao.CommunityBoardDAO">

<sql id="communityBoardColumns">
		  BOARD_NO
		, TITLE
		, CONTENT
		, HIT
		, REG_NO
		, MOD_NO
		, REG_DATE
		, MOD_DATE
	</sql>

	<insert id="insertBoard" parameterType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO">
<!-- 	   	<selectKey resultType="int" keyProperty="memberNo" order="BEFORE">
        	SELECT MEMBER_NO FROM MEMBER WHERE MEMBER_ID = #{memberId} 
    	</selectKey>
 -->	INSERT INTO COMMUNITYBOARD (
					  TITLE
					, CONTENT
					, HIT
					, REG_NO
					, MOD_NO
					, REG_DATE
					, MOD_DATE
		) VALUES (
			  #{TITLE}
			, #{CONTENT}
			, 0
			, #{member.getMemberNo}
			, #{member.getMemberNo}
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<select id="selectBoardDetail" parameterType="integer" resultType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO">
		SELECT
			  BOARD_NO
			, TITLE
			, CONTENT
			, HIT
			, REG_NO
			, REG_DATE
			, MOD_DATE
		FROM
			COMMUNITYBOARD
		WHERE
			BOARD_NO = #{boardNo}
	</select>

	<update id="updateBoard" parameterType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO">
		UPDATE COMMUNITYBOARD
		SET
			  MOD_DATE = SYSDATE
			, TITLE = #{title}
			, CONTENT = #{content}
		WHERE
			BOARD_NO = #{boardNo}
	</update>

	<update id="deleteBoard" parameterType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO">
		UPDATE COMMUNITYBOARD
		SET
			  DEL_YN = 'Y'
			, MOD_DATE = SYSDATE
		WHERE
			BOARD_NO = #{BOARDNO}
	</update>

	<select id="selectBoardList" parameterType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO" resultType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO">
		SELECT
			ROWNUM ,
			COM.BOARD_NO ,
			COM.TITLE ,
			COM.CONTENT ,
			COM.HIT ,
			COM.REG_NO,
			COM.MOD_NO,
			COM.REG_DATE,
			COM.MOD_DATE,
			M.NICKNAME
		FROM
			COMMUNITYBOARD COM 
			LEFT OUTER JOIN MEMBER M
            ON REG_NO = M.MEMBER_NO
		WHERE DEL_YN = 'N'
		ORDER BY
			COM.BOARD_NO DESC,
			COM.REG_DATE DESC
	</select>

	
	<update id="updateHit" parameterType="Integer">
		UPDATE
			COMMUNITYBOARD 
		SET 
			HIT = HIT + 1
		WHERE
			BOARD_NO = #{boardNo}
	</update>

	<select id="selectBoardTotalCount" parameterType="com.koreait.dooboo.communityboard.dto.CommunityBoardDTO" resultType="int">
		SELECT
			COUNT(*)
		FROM
			COMMUNITYBOARD
		WHERE
			del_yn = 'N'
			<!-- <if test="searchType != '' and searchType != null">
				<if test="searchKeyword != '' and searchKeyword != null">
					<if test="searchType == 'title' ">
					 	AND TITLE like concat('%',#{searchKeyword},'%')
					 </if>
					<if test="searchType == 'content' ">
					 	AND CONTENT like concat('%',#{searchKeyword},'%')
					 </if>
				</if>
			</if> -->
	</select>


</mapper>